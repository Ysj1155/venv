<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account Growth</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<form id="stock-form">
    <label for="ticker">Ticker:</label>
    <input type="text" id="ticker" name="ticker" required>
    <label for="price">Price:</label>
    <input type="number" id="price" name="price" required>
    <label for="quantity">Quantity:</label>
    <input type="number" id="quantity" name="quantity" required>
    <label for="purchase_time">Purchase Time:</label>
    <input type="date" id="purchase_time" name="purchase_time" required>
    <button type="submit">Add Stock</button>
</form>
<body>
    <h1>Account Growth Tracker</h1>
    <div id="graph"></div>
    <h2>Add Stock</h2>
    <form id="stock-form">
        <label for="ticker">Ticker:</label>
        <input type="text" id="ticker" name="ticker" required>
        <label for="price">Price:</label>
        <input type="number" id="price" name="price" required>
        <label for="quantity">Quantity:</label>
        <input type="number" id="quantity" name="quantity" required>
        <label for="purchase_time">Purchase Time:</label>
        <input type="date" id="purchase_time" name="purchase_time" required>
        <button type="submit">Add Stock</button>
    </form>
    <script>
        // 그래프 로드
        fetch("/get_graph_data")
            .then(response => response.json())
            .then(data => {
                Plotly.newPlot("graph", [{
                    x: data.dates,
                    y: data.profits,
                    type: "scatter",
                    mode: "lines+markers",
                    name: "Cumulative Profit"
                }]);
            });

        // 폼 제출 처리
        document.getElementById("stock-form").addEventListener("submit", function (event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            fetch("/add_stock", {
                method: "POST",
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                location.reload();
            });
        });
    </script>
</body>
<table>
    <thead>
        <tr>
            <th>Ticker</th>
            <th>Price</th>
            <th>Quantity</th>
            <th>Purchase Time</th>
            <th>Current Price</th>
            <th>Profit (%)</th>
        </tr>
    </thead>
    <tbody>
        {% for stock in stocks %}
        <tr>
            <td>{{ stock.ticker }}</td>
            <td>{{ stock.price }}</td>
            <td>{{ stock.quantity }}</td>
            <td>{{ stock.purchase_time }}</td>
            <td>{{ stock.current_price }}</td>
            <td>{{ stock.profit_percent }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
</html>
