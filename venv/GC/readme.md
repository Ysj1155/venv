# SSD Garbage Collection Simulator

## í”„ë¡œì íŠ¸ ê°œìš”
ë³¸ í”„ë¡œì íŠ¸ëŠ” **SSD(ì†”ë¦¬ë“œ ìŠ¤í…Œì´íŠ¸ ë“œë¼ì´ë¸Œ)ì˜ Garbage Collection(GC) ì•Œê³ ë¦¬ì¦˜ì„ ì‹œë®¬ë ˆì´ì…˜í•˜ê³  ì‹œê°í™”**í•˜ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤.  
SSDëŠ” NAND í”Œë˜ì‹œ ë©”ëª¨ë¦¬ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ë©°, ë®ì–´ì“°ê¸° ë¶ˆê°€(erase-before-write)ë¼ëŠ” íŠ¹ì„± ë•Œë¬¸ì— **GC ê³¼ì •**ì´ í•„ìˆ˜ì ì…ë‹ˆë‹¤.  
ê·¸ëŸ¬ë‚˜ GCëŠ” SSDì˜ **ì“°ê¸° ì¦í­(Write Amplification)**, **ì„±ëŠ¥ ì €í•˜**, **ìˆ˜ëª… ë‹¨ì¶•**ì„ ìœ ë°œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:contentReference[oaicite:0]{index=0}.  

ë³¸ ì—°êµ¬ì—ì„œëŠ” ë‹¤ì–‘í•œ GC ì •ì±…(ì˜ˆ: Greedy, Cost-Benefit, BSGC ë“±)ì„ ì†Œí”„íŠ¸ì›¨ì–´ë¡œ êµ¬í˜„í•˜ì—¬, **ì›Œí¬ë¡œë“œë³„ ì„±ëŠ¥ ì°¨ì´ë¥¼ ì •ëŸ‰ì ìœ¼ë¡œ ë¶„ì„**í•©ë‹ˆë‹¤.  
ì´ë¥¼ í†µí•´ GCê°€ SSD ì„±ëŠ¥, ë‚´êµ¬ì„±, QoSì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì„ íŒŒì•…í•˜ê³ , ì‹œê°í™” ë° ë¹„êµë¥¼ í†µí•´ ì´í•´ë¥¼ ë•ëŠ” ê²ƒì´ í•µì‹¬ ëª©í‘œì…ë‹ˆë‹¤.

---

## ì—°êµ¬ ëª©ì 
- **í•™ìˆ ì  ë™ê¸°**  
  - SSD GCëŠ” ì˜¤ë²„í—¤ë“œê°€ í¬ê³ , QoS ì €í•˜ ë° ì§€ì—°(latency)ì„ ìœ ë°œ.
  - ê¸°ì¡´ ì—°êµ¬ëŠ” íš¨ìœ¨ì ì¸ í¬ìƒ ë¸”ë¡ ì„ íƒ(Greedy, CB, CAT, BSGC ë“±) ê¸°ë²•ì„ ì œì•ˆí–ˆìœ¼ë‚˜, ì‹¤ì œ ì›Œí¬ë¡œë“œ ì‹œë®¬ë ˆì´ì…˜ ê¸°ë°˜ ë¹„êµê°€ ë¶€ì¡±.
- **ì‹¤ë¬´ì  ë™ê¸°**  
  - ë°ì´í„°ì„¼í„°Â·ì‹¤ì‹œê°„ ì‹œìŠ¤í…œì—ì„œëŠ” tail latencyì™€ ì•ˆì •ì ì¸ ì„±ëŠ¥ ë³´ì¥ì´ í•„ìš”.
  - GC ì •ì±… ì°¨ì´ê°€ RocksDB ë“± DBMSì™€ ìŠ¤í† ë¦¬ì§€ ê³„ì¸µì˜ ì„±ëŠ¥ì— ì§ì ‘ì ì¸ ì˜í–¥ì„ ë¯¸ì¹¨.

## ì—°êµ¬ ëª©í‘œ

ë³¸ í”„ë¡œì íŠ¸ì˜ ìµœì¢… ëª©í‘œëŠ” ë‹¨ìˆœ ë¹„êµë¥¼ ë„˜ì–´ **ë³´ë‹¤ íš¨ìœ¨ì ì¸ GC/ë°°ì¹˜ ì •ì±…ì„ ì„¤ê³„Â·êµ¬í˜„**í•˜ê³ , ë‹¤ì–‘í•œ ì›Œí¬ë¡œë“œì—ì„œ **ì •ëŸ‰ì  ê·¼ê±°**ë¡œ ê·¸ ìœ íš¨ì„±ì„ ì…ì¦í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

### ì—°êµ¬ ì§ˆë¬¸ (RQs)
- **RQ1.** Hot/Cold í¸ì¤‘, ì—…ë°ì´íŠ¸ ë¹„ìœ¨, OP(Over-Provisioning) ìˆ˜ì¤€ì´ WAF/GC ë¹ˆë„/ë§ˆëª¨ ê· í˜•ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì€?
- **RQ2.** ê¸°ì¡´ ì •ì±…(Greedy/CB/BSGC)ì˜ ê°•Â·ì•½ì ì€ ë¬´ì—‡ì´ë©°, ì–´ë–¤ ì¡°ê±´ì—ì„œ ì„±ëŠ¥/ë‚´êµ¬ì„±/ì§€ì—° ì¸¡ë©´ì˜ ì—­ì „ì´ ë°œìƒí•˜ëŠ”ê°€?
- **RQ3.** *ì˜¨ë„(Hotness)Â·ë¬´íš¨ë¹„Â·ë§ˆëª¨*ë¥¼ í•¨ê»˜ ê³ ë ¤í•˜ëŠ” **ê²½ëŸ‰ ì ìˆ˜ì‹**(ì˜ˆ: temperature-aware cost-benefit)ì´ ê¸°ì¡´ ëŒ€ë¹„ ì„±ëŠ¥/ë‚´êµ¬ì„±ì„ ê°œì„ í•˜ëŠ”ê°€?
- **RQ4.** â€œí•œ ë²ˆì˜ í˜¸ìŠ¤íŠ¸ ì“°ê¸° ì „ì— GC ìµœëŒ€ 1íšŒâ€ ê°™ì€ **ìŠ¤ì¼€ì¤„ë§ ì œì•½**ì´ tail latency ë° WAFì— ì£¼ëŠ” ì˜í–¥ì€?
- **RQ5.** TRIM/OP/ë¡œê·¸ êµ¬ì¡° ì“°ê¸°(dual active logs)ì˜ ì¡°í•©ì´ **ì“°ê¸° ì¦í­ê³¼ wear-leveling**ì„ ì–´ë–»ê²Œ ë°”ê¾¸ëŠ”ê°€?

### ì ‘ê·¼ ë°©ì‹
- **ì‹œë®¬ë ˆì´í„° ê¸°ë°˜**: í˜ì´ì§€/ë¸”ë¡/ì±„ë„ ë‹¨ìœ„ ëª¨ë¸, Reverse Map, Active Block, GC ì‹œê°„ ê³„ì¸¡ í¬í•¨
- **ì •ì±… ë¹„êµ**: Greedy / CB / BSGC / Temperature-aware CB(+ wear, age)
- **ì§€í‘œ**: WAF, GC count, wear Î”, GC time(avg/p50/p95/p99), free-pages íƒ€ì„ë¼ì¸ ì•ˆì •ì„±
- **ì›Œí¬ë¡œë“œ**: ì—…ë°ì´íŠ¸ ë¹„ìœ¨Â·Hot/Cold í¸ì¤‘Â·OPÂ·TRIMì„ ì¡°í•©í•œ ìŠ¤ìœ•

### ê¸°ëŒ€ ì‚°ì¶œë¬¼
- ì¬í˜„ ê°€ëŠ¥í•œ **ì‹¤í—˜ ìŠ¤í¬ë¦½íŠ¸ & CSV/í”Œë¡¯**, 
- **ê°œì„  ì•Œê³ ë¦¬ì¦˜(ì ìˆ˜ì‹/ì˜ì‚¬ì½”ë“œ/ì‹¤í—˜ê²°ê³¼)**,

---

## í˜„ì¬ê¹Œì§€ ì§„í–‰ ìƒí™©
1. **ê°œë°œ í™˜ê²½ ì„¸íŒ…**
   - `venv` ê°€ìƒí™˜ê²½ ìƒì„± ë° `GC` ë””ë ‰í† ë¦¬ êµ¬ì¶•
   - Python ê¸°ë°˜ ì‹œë®¬ë ˆì´í„° ì½”ë“œ ì´ˆê¸° ì‘ì„±

2. **GC ì•Œê³ ë¦¬ì¦˜ êµ¬í˜„**
   - Greedy ì •ì±… êµ¬í˜„ ë° ì‹¤í–‰ ì„±ê³µ
   - ì‹¤í–‰ ëª…ë ¹ì–´ ì˜ˆì‹œ:
     ```bash
     python run_sim.py --gc_policy greedy --ops 5000 --update_ratio 0.8
     ```

3. **ì‹¤í—˜ ê²°ê³¼**  
=== Simulation Result ===  
Host writes (pages):   5,000  
Device writes (pages): 5,639  
WAF (device/host):     1.128  
GC count:              243  
Avg erase per block:   0.95 (min=0, max=2, Î”=2)  
Free pages remaining:  13849 / 16384    
- Host write ëŒ€ë¹„ Device writeê°€ ë§ì•„ ì“°ê¸° ì¦í­ ë°œìƒ(WAF > 1)
- Garbage Collectionì´ 243íšŒ ìˆ˜í–‰ë¨    
- ì •ìƒì ìœ¼ë¡œ GC ë™ì‘ ë° ì„±ëŠ¥ ì§€í‘œ ì‚°ì¶œ í™•ì¸    

---

## ğŸ“… ì•ìœ¼ë¡œì˜ ê³„íš
- [ ] Cost-Benefit, CAT, BSGC ë“± ë‹¤ë¥¸ GC ì•Œê³ ë¦¬ì¦˜ êµ¬í˜„
- [ ] GC ì •ì±…ë³„ WAF, GC íšŸìˆ˜, ì§€ì—°(latency) ë¹„êµ
- [ ] RocksDBì™€ ì—°ê³„ëœ DB workload ì ìš© ì‹¤í—˜
- [ ] ì‹œê°í™”(ê·¸ë˜í”„) ë„êµ¬ë¥¼ í†µí•´ ì„±ëŠ¥ ì°¨ì´ ë¶„ì„
- [ ] ìµœì¢… ë³´ê³ ì„œ ë° ë°œí‘œ ìë£Œ ì œì‘

---

## ğŸ“– ì°¸ê³  ë¬¸í—Œ
- ê¹€í•œì–¼, *ë¨¸ì‹ ëŸ¬ë‹ ì•Œê³ ë¦¬ì¦˜ì„ í†µí•œ SSD ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ ê°ì§€ ë° ê´€ë¦¬ ê¸°ë²•*, í™ìµëŒ€, 2014:contentReference[oaicite:6]{index=6}  
- ì˜¤ìŠ¹ì§„, *RocksDB SSTable í¬ê¸°ê°€ ì„±ëŠ¥ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ ë¶„ì„*, ì„±ê· ê´€ëŒ€, 2022:contentReference[oaicite:7]{index=7}  
- ê¹€ì„±í˜¸ ì™¸, *SSD ê¸°ë°˜ ì €ì¥ì¥ì¹˜ ì‹œìŠ¤í…œì—ì„œ ë§ˆëª¨ë„ ê· í˜•ê³¼ ë‚´êµ¬ì„± í–¥ìƒì„ ìœ„í•œ ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ ê¸°ë²•*, í•œêµ­ì»´í“¨í„°ì •ë³´í•™íšŒë…¼ë¬¸ì§€, 2017:contentReference[oaicite:8]{index=8}  
- ë°•ìƒí˜, *Analysis of the K2 Scheduler for a Real-Time System with a SSD*, ì„±ê· ê´€ëŒ€, 2021:contentReference[oaicite:9]{index=9}

---

## Changelog â€” 2025-09-21

### 1) ì„±ëŠ¥/ì•ˆì •ì„± ê°œì„ 
- **Reverse Map ë„ì…**: `(block, page) â†’ LPN` ì—­ë§¤í•‘ ì¶”ê°€ë¡œ GC ë§ˆì´ê·¸ë ˆì´ì…˜ íƒìƒ‰ì„ O(ìœ íš¨í˜ì´ì§€)ë¡œ ë‹¨ì¶•.
- **Active Block(ë¡œê·¸ êµ¬ì¡° ì“°ê¸°)** ì ìš©: í™œì„± ë¸”ë¡ì— ì—°ì† ê¸°ë¡ â†’ ì¡°ê°í™” ì™„í™”, WAF/GC ê°ì†Œ ê¸°ëŒ€.

### 2) GC í­ì£¼ ë°©ì§€
- **Simulator ì •ì±… ìˆ˜ì •**: â€œí˜¸ìŠ¤íŠ¸ 1íšŒ ì“°ê¸° ì „ì— GC ìµœëŒ€ 1íšŒâ€ë¡œ ì œí•œí•˜ì—¬ ì—°ì‡„ GC ë°œìƒ ì–µì œ.

### 3) ì¸¡ì • ì§€í‘œ í™•ì¥
- **GC ì‹œê°„ ê³„ì¸¡**: `gc_total_time`, `gc_durations` ìˆ˜ì§‘.
- ì½˜ì†” ìš”ì•½ì— **GC total/avg/p50/p95/p99(ms)** ì¶œë ¥ ì¶”ê°€.
- CSV(`--out_csv`)ì—ë„ `gc_time_total_ms, gc_time_avg_ms, gc_time_p50_ms, gc_time_p95_ms, gc_time_p99_ms` ì»¬ëŸ¼ ê¸°ë¡.

### 4) ê²°ê³¼ ì‹œê°í™” ìœ í‹¸
- **`analyze_results.py` ì¶”ê°€**: `results.csv`ë¡œë¶€í„° WAF / GC_count / GC p99 ê·¸ë˜í”„ ìƒì„±(`plots/` ì €ì¥).

### 5) GC ì •ì±… í™•ì¥(ì˜µì…˜)
- **BSGC**(ê· í˜•í˜•) ê°„ë‹¨ êµ¬í˜„ ì¶”ê°€: ë¬´íš¨ë¹„ì™€ ë§ˆëª¨ ê· í˜•ì„ í•¨ê»˜ ê³ ë ¤.  
  â†’ `--gc_policy bsgc` ë¡œ ì‹¤í–‰ ê°€ëŠ¥.

### 6) ë²„ê·¸ í”½ìŠ¤
- `models.py` ë‚´ **`PageState` ëˆ„ë½ìœ¼ë¡œ ì¸í•œ NameError** í•´ê²°(íŒŒì¼ ì „ë©´ êµì²´).
- `metrics.py`ì˜ **`summarize_metrics` ë¯¸ì •ì˜ ImportError** í•´ê²° ë° CSV í•¨ìˆ˜ ë³´ê°•.

---

### ğŸ”§ ë³€ê²½ íŒŒì¼
- `models.py` : Reverse Map, Active Block, GC ì‹œê°„ ê³„ì¸¡ ì¶”ê°€
- `simulator.py` : 1-step ë‹¹ GC ìµœëŒ€ 1íšŒ ë¡œì§
- `metrics.py` : GC ì‹œê°„(ì´/í‰ê· /í¼ì„¼íƒ€ì¼) ì¶œë ¥ ë° CSV ê¸°ë¡
- `gc_algos.py` : `bsgc_policy` ë° `get_gc_policy()` ì—°ë™
- `analyze_results.py` : ê²°ê³¼ ì‹œê°í™” ìŠ¤í¬ë¦½íŠ¸ (ì‹ ê·œ)

## Changelog â€” 2025-10-04
- run_sim.py
    - ê²½ë¡œ ì²˜ë¦¬ ë¦¬íŒ©í† ë§: --out_dir/--out_csv/--trace_csv ì•ˆì „ ì´ˆê¸°í™”
    - ATCB ì •ì±… ì£¼ì… ì‹œì  fix(ì‹¤í–‰ ì „ ì£¼ì…)
    - ì›Œë°ì—…(prefill) ì˜µì…˜ ì¶”ê°€: --warmup_fill/--warmup_seed
    - TRIM ì´ë²¤íŠ¸ ì˜µì…˜ ì¶”ê°€: --trim_ratio
    - ë°±ê·¸ë¼ìš´ë“œ GC ì˜µì…˜ ì¶”ê°€: --bg_gc_every
    - per-GC ì´ë²¤íŠ¸ ë¡œê·¸ ì €ì¥: --gc_events_csv
    - (ì„ íƒ) --checkë¡œ ì‹¤í–‰ í›„ ë¶ˆë³€ì„± ê²€ì‚¬
- simulator.py
    - BG GC(í† í°ë²„í‚·í˜•) ì§€ì›, ìŠ¤í… íŠ¸ë ˆì´ìŠ¤ ë¡œê¹… ì •ë¦¬
- models.py
    - collect_garbage() ë‚´ ì´ë²¤íŠ¸ ë ˆì½”ë“œ ë‚¨ê¹€(gc_event_log)
- metrics.py
    - ëª¨ë“ˆ ì „ì—­ ì°¸ì¡° ì œê±°(ì•ˆì •í™”), 22ì—´ ìŠ¤í‚¤ë§ˆ í˜¸í™˜ ìœ ì§€
    - save_trace_csv()/save_gc_events_csv() ì œê³µ
- workload.py
    - TRIM ì§€ì›, í˜ì´ì¦ˆë“œ ì›Œí¬ë¡œë“œ ìœ í‹¸ ì¶”ê°€(make_phased_workload)
- sweep.py
    - results/YYYY-MM-DD/runNN[_tag]/ ìë™ ìƒì„± + LATEST.txt ê°±ì‹ 
    - OP ì¶•(user_capacity_ratio) ë° ATCB ê°€ì¤‘ì¹˜ ablation í¬í•¨
    - sweep_meta.json (+ ì˜µì…˜) requirements.txt ê¸°ë¡
- analyze_results.py
    - ë‹¨ì¼/ë³‘í•©/ìµœì‹  ëª¨ë“œ ì§€ì›, ë ˆì´ë¸” íšŒì „/ì—¬ë°± ë³´ì •
    - ì‹ ê·œ/êµ¬ ìŠ¤í‚¤ë§ˆ í›„ë°©í˜¸í™˜(ì—†ëŠ” ì»¬ëŸ¼ì€ ìë™ ê±´ë„ˆëœ€)
- ìš©ëŸ‰ ì—¬ìœ ê°€ í¬ê³  OPSê°€ ì‘ìœ¼ë©´ GCê°€ 0 â†’ WAF=1.0ì´ ë‚˜ì˜¬ ìˆ˜ ìˆìŒ
â†’ í•„ìš” ì‹œ OPSâ†‘, --blocksâ†“, --warmup_fillë¡œ steady-state ë¹„êµ ê¶Œì¥.

### â–¶ï¸ ì‹¤í–‰ ì˜ˆì‹œ
```bash
# ì‹¤í—˜ ìˆ˜í–‰ + CSV ì €ì¥
python run_sim.py --gc_policy greedy --ops 5000 --update_ratio 0.8 --hot_ratio 0.2 --hot_weight 0.85 --out_csv results.csv --note "greedy_rl1"
python run_sim.py --gc_policy cb     --ops 5000 --update_ratio 0.8 --hot_ratio 0.2 --hot_weight 0.85 --out_csv results.csv --note "cb_rl1"
python run_sim.py --gc_policy bsgc   --ops 5000 --update_ratio 0.8 --hot_ratio 0.2 --hot_weight 0.85 --out_csv results.csv --note "bsgc_rl1"

# ê·¸ë˜í”„ ìƒì„±
python analyze_results.py   # plots/waf_by_run.png, gc_by_run.png, gc_p99_by_run.png